:target{#extended-specification}

# 扩展标准

:target{#table-of-contents}

## 目录

:target{#cluster-proto}

### cluster.proto

- Messages
  - [SFClusterConfig](#sfclusterconfig)
  - [SFClusterConfig.PrivateConfig](#sfclusterconfig-privateconfig)
  - [SFClusterConfig.PublicConfig](#sfclusterconfig-publicconfig)
  - [SFClusterConfig.RayFedConfig](#sfclusterconfig-rayfedconfig)
  - [SFClusterConfig.SPUConfig](#sfclusterconfig-spuconfig)
  - [SFClusterDesc](#sfclusterdesc)
  - [SFClusterDesc.DeviceDesc](#sfclusterdesc-devicedesc)
  - [SFClusterDesc.RayFedConfig](#sfclusterdesc-rayfedconfig)

:target{#data-proto}

### data.proto

- Messages
  - [DeviceObjectCollection](#deviceobjectcollection)
  - [DeviceObjectCollection.DeviceObject](#deviceobjectcollection-deviceobject)

:target{#id1}

## cluster.proto

Proto file: [secretflow/protos/secretflow/spec/extend/cluster.proto](https://github.com/secretflow/secretflow/tree/main/secretflow/protos/secretflow/spec/extend/cluster.proto)

:target{#messages}

### Messages

:target{#sfclusterconfig}

#### SFClusterConfig

SecretFlow 集群的运行时配置。除了内在的 SFClusterDesc 外，还提供了动态网络配置

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        desc
      </td>

      <td>
        [ SFClusterDesc](#sfclusterdesc)
      </td>

      <td>
        内在属性。
      </td>
    </tr>

    <tr>
      <td>
        public\_config
      </td>

      <td>
        [ SFClusterConfig.PublicConfig](#sfclusterconfig-publicconfig)
      </td>

      <td>
        动态运行时公共配置。
      </td>
    </tr>

    <tr>
      <td>
        private\_config
      </td>

      <td>
        [ SFClusterConfig.PrivateConfig](#sfclusterconfig-privateconfig)
      </td>

      <td>
        动态运行时私有配置。
      </td>
    </tr>
  </tbody>
</table>

:target{#sfclusterconfig-privateconfig}

#### SFClusterConfig.PrivateConfig

对于每个参与方都不同。对于每个参与方是私有且唯一的。

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        self\_party
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        none
      </td>
    </tr>

    <tr>
      <td>
        ray\_head\_addr
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        none
      </td>
    </tr>
  </tbody>
</table>

:target{#sfclusterconfig-publicconfig}

#### SFClusterConfig.PublicConfig

对所有参与方公开且共享的。

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        ray\_fed 配置。
      </td>

      <td>
        [ SFClusterConfig.RayFedConfig](#sfclusterconfig-rayfedconfig)
      </td>

      <td>
        none
      </td>
    </tr>

    <tr>
      <td>
        spu\_configs
      </td>

      <td>
        [repeated SFClusterConfig.SPUConfig](#sfclusterconfig-spuconfig)
      </td>

      <td>
        none
      </td>
    </tr>
  </tbody>
</table>

:target{#sfclusterconfig-rayfedconfig}

#### SFClusterConfig.RayFedConfig

每个参与方的 RayFed 集群地址。

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        parties
      </td>

      <td>
        [<span>repeated string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        none
      </td>
    </tr>

    <tr>
      <td>
        addresses
      </td>

      <td>
        [<span>repeated string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        none
      </td>
    </tr>

    <tr>
      <td>
        listen\_addresses
      </td>

      <td>
        [<span>repeated string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        none
      </td>
    </tr>
  </tbody>
</table>

:target{#sfclusterconfig-spuconfig}

#### SFClusterConfig.SPUConfig

包含一个 SPU 设备的地址。

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        name
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        应与 SFClusterDesc.devices 中的 SPU 名称匹配
      </td>
    </tr>

    <tr>
      <td>
        parties
      </td>

      <td>
        [<span>repeated string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        none
      </td>
    </tr>

    <tr>
      <td>
        addresses
      </td>

      <td>
        [<span>repeated string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        none
      </td>
    </tr>

    <tr>
      <td>
        listen\_addresses
      </td>

      <td>
        [<span>repeated string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        none
      </td>
    </tr>
  </tbody>
</table>

:target{#sfclusterdesc}

#### SFClusterDesc

SecretFlow 集群的内在属性，包括

- 版本信息。
- 参与计算的各方。
- 包括秘密设备及其配置

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        sf\_version
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        SecretFlow版本
      </td>
    </tr>

    <tr>
      <td>
        py\_version
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        Python 版本
      </td>
    </tr>

    <tr>
      <td>
        parties
      </td>

      <td>
        [<span>repeated string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        参与实体. e.g. \[“alice”, “bob”,…].
      </td>
    </tr>

    <tr>
      <td>
        devices
      </td>

      <td>
        [repeated SFClusterDesc.DeviceDesc](#sfclusterdesc-devicedesc)
      </td>

      <td>
        秘密设备的描述
      </td>
    </tr>

    <tr>
      <td>
        ray\_fed 配置。
      </td>

      <td>
        [ SFClusterDesc.RayFedConfig](#sfclusterdesc-rayfedconfig)
      </td>

      <td>
        none
      </td>
    </tr>
  </tbody>
</table>

:target{#sfclusterdesc-devicedesc}

#### SFClusterDesc.DeviceDesc

一个秘密设备的描述。

- PYU 不需要声明，因为它们是明文设备。
- 配置说明：目前，您必须为不同的设备提供一个 JSON 字符串。我们将在未来规范化此部分。
  - 示例 SPU 配置：

```json
{
    "runtime_config": {
        "protocol": "REF2K",
        "field": "FM64"
    },
    "link_desc": {
        "connect_retry_times": 60,
        "connect_retry_interval_ms": 1000,
        "brpc_channel_protocol": "http",
        "brpc_channel_connection_type": "pooled",
        "recv_timeout_ms": 1200000,
        "http_timeout_ms": 1200000
    }
}
```

参考: [SPU](https://www.secretflow.org.cn/docs/spu/latest/en-US/reference/runtime_config#runtimeconfig) | [HEU](https://www.secretflow.org.cn/docs/secretflow/latest/en-US/source/secretflow.device.device.device#secretflow.device.device.heu.HEU.__init__) 。

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        name
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        设备名称。
      </td>
    </tr>

    <tr>
      <td>
        type
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        可选: SPU, HEU, TEEU.
      </td>
    </tr>

    <tr>
      <td>
        parties
      </td>

      <td>
        [<span>repeated string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        设备组成各方。
      </td>
    </tr>

    <tr>
      <td>
        config
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        秘密设备的特别配置。
      </td>
    </tr>
  </tbody>
</table>

:target{#sfclusterdesc-rayfedconfig}

#### SFClusterDesc.RayFedConfig

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        cross\_silo\_comm\_backend
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        Indicates communication backend of RayFed. Accepted: ‘grpc’, ‘brpc\_link’ Dafault is ‘grpc’
      </td>
    </tr>
  </tbody>
</table>

:target{#enums}

### Enums

:target{#id2}

## data.proto

Proto file: [secretflow/protos/secretflow/spec/extend/data.proto](https://github.com/secretflow/secretflow/tree/main/secretflow/protos/secretflow/spec/extend/data.proto)

:target{#id3}

### Messages

:target{#deviceobjectcollection}

#### DeviceObjectCollection

描述设备对象集合的公共存储信息。

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        objs
      </td>

      <td>
        [repeated DeviceObjectCollection.DeviceObject](#deviceobjectcollection-deviceobject)
      </td>

      <td>
        none
      </td>
    </tr>

    <tr>
      <td>
        public\_info
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        任何公共信息。
      </td>
    </tr>
  </tbody>
</table>

:target{#deviceobjectcollection-deviceobject}

#### DeviceObjectCollection.DeviceObject

<table>
  <thead>
    <tr>
      <td>
        Field
      </td>

      <td>
        Type
      </td>

      <td>
        Description
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        type
      </td>

      <td>
        [<span> string</span>](https://docs.python.org/3/library/string.html#module-string "Python 3.12")
      </td>

      <td>
        可选: `spu | pyu`
      </td>
    </tr>

    <tr>
      <td>
        data\_ref\_idxs
      </td>

      <td>
        [<span>repeated int32</span>](#int32)
      </td>

      <td>
        data\_ref 在父级 DistData 消息中的索引。
      </td>
    </tr>
  </tbody>
</table>

:target{#id4}

### Enums
