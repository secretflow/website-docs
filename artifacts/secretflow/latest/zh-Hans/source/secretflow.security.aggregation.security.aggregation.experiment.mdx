:target{#secretflow-security-aggregation-experiment-package}

# secretflow\.security.aggregation.experiment package

:target{#submodules}

## Submodules

:target{id="module-secretflow.security.aggregation.experiment.mask_heu_aggregator"}

## secretflow\.security.aggregation.experiment.mask\_heu\_aggregator module

<strong>Classes:</strong>

<table>
  <tbody>
    <tr>
      <td>
        [`Masker`](#secretflow.security.aggregation.experiment.mask_heu_aggregator.Masker "secretflow.security.aggregation.experiment.mask_heu_aggregator.Masker")
      </td>

      <td>
        `ActorProxy(Masker)` 的别名
      </td>
    </tr>

    <tr>
      <td>
        [`MaskHeuAggregator`](#secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator "secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator")(device, participants\[, ...])
      </td>

      <td>
        <del id="id2">Mask\_</del> <del id="id4">Heu\_</del> Aggregation presents a new federated learning secure aggregation algorithm, in which participants add mask at some positions of the gradient (the fully connected layer closest to the output layer), Then use homomorphic encryption to remove masks from the aggregated values
      </td>
    </tr>
  </tbody>
</table>

<Outline domain="py" objectType="attribute" target={"secretflow.security.aggregation.experiment.mask_heu_aggregator.Masker"} module={"secretflow.security.aggregation.experiment.mask_heu_aggregator"} fullname={"Masker"} description={"ActorProxy(Masker) \u7684\u522b\u540d\nMethods:"}>
  <Outline.Signature fullname="Masker" id="secretflow.security.aggregation.experiment.mask_heu_aggregator.Masker">
    <Outline.Prefix>secretflow\.security.aggregation.experiment.mask\_heu\_aggregator.</Outline.Prefix><Outline.Name>Masker</Outline.Name>
  </Outline.Signature>

  <Outline.Content>
    `ActorProxy(Masker)` 的别名
    <strong>Methods:</strong>

    <table>
      <tbody>
        <tr>
          <td>
            `__init__`(\*args, \*\*kwargs)
          </td>

          <td>
            Abstraction device object base class.
          </td>
        </tr>

        <tr>
          <td>
            `get_mask`()
          </td>

          <td>

          </td>
        </tr>

        <tr>
          <td>
            `add_noisy`(data\[, weight, mask\_location])
          </td>

          <td>

          </td>
        </tr>
      </tbody>
    </table>

    <strong>Attributes:</strong>

    <table>
      <tbody>
        <tr>
          <td>
            `device`
          </td>

          <td>

          </td>
        </tr>
      </tbody>
    </table>
  </Outline.Content>
</Outline>

<Outline domain="py" objectType="class" target={"secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator"} module={"secretflow.security.aggregation.experiment.mask_heu_aggregator"} fullname={"MaskHeuAggregator"} parameters={["device", "participants", "mask_location"]} description={"\u57fa\u7c7b\uff1aAggregator"}>
  <Outline.Signature fullname="MaskHeuAggregator" id="secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator">
    <Outline.Keyword>class<span>{" "}</span></Outline.Keyword><Outline.Prefix>secretflow\.security.aggregation.experiment.mask\_heu\_aggregator.</Outline.Prefix><Outline.Name>MaskHeuAggregator</Outline.Name><Outline.ParameterList><span>(</span><Outline.Parameter><span className="name">device</span><span>:</span><span>{" "}</span><span className="name">[PYU](secretflow.device.device.device.mdx#secretflow.device.device.pyu.PYU "secretflow.device.device.pyu.PYU")</span></Outline.Parameter>, <Outline.Parameter><span className="name">participants</span><span>:</span><span>{" "}</span><span className="name">[List](https://docs.python.org/3/library/typing.html#typing.List "（在 Python v3.12）")<span>\[</span>[PYU](secretflow.device.device.device.mdx#secretflow.device.device.pyu.PYU "secretflow.device.device.pyu.PYU")<span>]</span></span></Outline.Parameter>, <Outline.Parameter><span className="name">mask\_location</span><span>=</span><span>-2</span></Outline.Parameter><span>)</span></Outline.ParameterList>
  </Outline.Signature>

  <Outline.Content>
    基类：[`Aggregator`](secretflow.security.security.aggregation.mdx#secretflow.security.aggregation.aggregator.Aggregator "secretflow.security.aggregation.aggregator.Aggregator")

    <del id="id6">Mask\_</del> <del id="id8">Heu\_</del> Aggregation presents a new federated learning secure aggregation algorithm, in which
    participants add mask at some positions of the gradient (the fully connected layer closest to the
    output layer), Then use homomorphic encryption to remove masks from the aggregated values

    The specific process is as follows.

    1\. After the participant generates the gradient locally,they add a mask at some positions of the
    gradient (the fully connected layer closest to the output layer) and use paillier homomorphic encryption
    on the mask

    2. Participants will send gradients with masks and encrypted masks to the server for aggregation

    3\. The server aggregates gradients using addition, aggregates masks in ciphertext state using homomorphic
    addition, and finally returns the aggregation results to the participants

    4. The participant decrypts the aggregated values of the mask and ultimately obtains a noise free aggregation result

    <p className="sidebar-rubric">
      备注
    </p>

    Analyzing the reasons for gradient leakage of privacy information, we found that certain positions of the

    gradient contain sensitive information. Based on the above findings, we designed this aggregation algorithm
    For more information, please refer to [https://openaccess.thecvf.com/content/CVPR2021/papers/Sun\_Soteria\_Provable\_Defense\_Against\_Privacy\_Leakage\_in\_Federated\_Learning\_From\_CVPR\_2021\_paper.pdf](https://openaccess.thecvf.com/content/CVPR2021/papers/Sun_Soteria_Provable_Defense_Against_Privacy_Leakage_in_Federated_Learning_From_CVPR_2021_paper.pdf)
    and [https://arxiv.org/abs/2001.02610](https://arxiv.org/abs/2001.02610)

    <p className="sidebar-rubric">
      示例
    </p>

    ```python
    >>> # Alice and bob are both pyu instances.
    >>> aggregator = MaskHeuAggregator(alice, [alice, bob])
    >>> a = alice(lambda :  np.array([[1, 2, 3]]))()
    >>> b = bob(lambda : np.array([[11, 12, 13]]))()
    >>> avg_a_b = aggregator.average([a, b], axis=0)
    >>> # Get the result.
    >>> sf.reveal(avg_a_b)
        array([[6. 7. 8.]])
    >>> sum_a_b = aggregator.sum([a, b], axis=0)
    >>> sf.reveal(sum_a_b)
        array([[12. 14. 16.]])
    ```

    <strong>Methods:</strong>

    <table>
      <tbody>
        <tr>
          <td>
            [`__init__`](#secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.__init__ "secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.__init__")(device, participants\[, mask\_location])
          </td>

          <td>

          </td>
        </tr>

        <tr>
          <td>
            [`average`](#secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.average "secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.average")(data\[, axis, weights])
          </td>

          <td>
            Compute the weighted average along the specified axis.
          </td>
        </tr>

        <tr>
          <td>
            [`sum`](#secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.sum "secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.sum")(data\[, axis])
          </td>

          <td>
            Sum of array elements over a given axis.
          </td>
        </tr>
      </tbody>
    </table>

    <Outline domain="py" objectType="method" target={"secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.__init__"} module={"secretflow.security.aggregation.experiment.mask_heu_aggregator"} fullname={"MaskHeuAggregator.__init__"} parameters={["device", "participants", "mask_location"]} description={"\u57fa\u7c7b\uff1aAggregator"}>
      <Outline.Signature fullname="MaskHeuAggregator.__init__" id="secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.__init__">
        <Outline.Name>\_\_init\_\_</Outline.Name><Outline.ParameterList><span>(</span><Outline.Parameter><span className="name">device</span><span>:</span><span>{" "}</span><span className="name">[PYU](secretflow.device.device.device.mdx#secretflow.device.device.pyu.PYU "secretflow.device.device.pyu.PYU")</span></Outline.Parameter>, <Outline.Parameter><span className="name">participants</span><span>:</span><span>{" "}</span><span className="name">[List](https://docs.python.org/3/library/typing.html#typing.List "（在 Python v3.12）")<span>\[</span>[PYU](secretflow.device.device.device.mdx#secretflow.device.device.pyu.PYU "secretflow.device.device.pyu.PYU")<span>]</span></span></Outline.Parameter>, <Outline.Parameter><span className="name">mask\_location</span><span>=</span><span>-2</span></Outline.Parameter><span>)</span></Outline.ParameterList>
      </Outline.Signature>

      <Outline.Content />
    </Outline>

    <Outline domain="py" objectType="method" target={"secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.average"} module={"secretflow.security.aggregation.experiment.mask_heu_aggregator"} fullname={"MaskHeuAggregator.average"} parameters={["data", "axis", "weights"]} description={"Compute the weighted average along the specified axis."}>
      <Outline.Signature fullname="MaskHeuAggregator.average" id="secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.average">
        <Outline.Name>average</Outline.Name><Outline.ParameterList><span>(</span><Outline.Parameter><span className="name">data</span><span>:</span><span>{" "}</span><span className="name">[List](https://docs.python.org/3/library/typing.html#typing.List "（在 Python v3.12）")<span>\[</span>[DeviceObject](secretflow.device.device.device.mdx#secretflow.device.device.base.DeviceObject "secretflow.device.device.base.DeviceObject")<span>]</span></span></Outline.Parameter>, <Outline.Parameter><span className="name">axis</span><span>=</span><span>None</span></Outline.Parameter>, <Outline.Parameter><span className="name">weights</span><span>=</span><span>None</span></Outline.Parameter><span>)</span></Outline.ParameterList>
      </Outline.Signature>

      <Outline.Content>
        Compute the weighted average along the specified axis.
      </Outline.Content>
    </Outline>

    <Outline domain="py" objectType="method" target={"secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.sum"} module={"secretflow.security.aggregation.experiment.mask_heu_aggregator"} fullname={"MaskHeuAggregator.sum"} parameters={["data", "axis"]} description={"Sum of array elements over a given axis."}>
      <Outline.Signature fullname="MaskHeuAggregator.sum" id="secretflow.security.aggregation.experiment.mask_heu_aggregator.MaskHeuAggregator.sum">
        <Outline.Name>sum</Outline.Name><Outline.ParameterList><span>(</span><Outline.Parameter><span className="name">data</span><span>:</span><span>{" "}</span><span className="name">[List](https://docs.python.org/3/library/typing.html#typing.List "（在 Python v3.12）")<span>\[</span>[DeviceObject](secretflow.device.device.device.mdx#secretflow.device.device.base.DeviceObject "secretflow.device.device.base.DeviceObject")<span>]</span></span></Outline.Parameter>, <Outline.Parameter><span className="name">axis</span><span>=</span><span>None</span></Outline.Parameter><span>)</span></Outline.ParameterList>
      </Outline.Signature>

      <Outline.Content>
        Sum of array elements over a given axis.
      </Outline.Content>
    </Outline>
  </Outline.Content>
</Outline>

:target{id="module-secretflow.security.aggregation.experiment"}

## Module contents

<strong>Classes:</strong>

<table>
  <tbody>
    <tr>
      <td>
        [`MaskHeuAggregator`](#secretflow.security.aggregation.experiment.MaskHeuAggregator "secretflow.security.aggregation.experiment.MaskHeuAggregator")(device, participants\[, ...])
      </td>

      <td>
        <del id="id10">Mask\_</del> <del id="id12">Heu\_</del> Aggregation presents a new federated learning secure aggregation algorithm, in which participants add mask at some positions of the gradient (the fully connected layer closest to the output layer), Then use homomorphic encryption to remove masks from the aggregated values
      </td>
    </tr>
  </tbody>
</table>

<Outline domain="py" objectType="class" target={"secretflow.security.aggregation.experiment.MaskHeuAggregator"} module={"secretflow.security.aggregation.experiment"} fullname={"MaskHeuAggregator"} parameters={["device", "participants", "mask_location"]} description={"\u57fa\u7c7b\uff1aAggregator"}>
  <Outline.Signature fullname="MaskHeuAggregator" id="secretflow.security.aggregation.experiment.MaskHeuAggregator">
    <Outline.Keyword>class<span>{" "}</span></Outline.Keyword><Outline.Prefix>secretflow\.security.aggregation.experiment.</Outline.Prefix><Outline.Name>MaskHeuAggregator</Outline.Name><Outline.ParameterList><span>(</span><Outline.Parameter><span className="name">device</span><span>:</span><span>{" "}</span><span className="name">[PYU](secretflow.device.device.device.mdx#secretflow.device.device.pyu.PYU "secretflow.device.device.pyu.PYU")</span></Outline.Parameter>, <Outline.Parameter><span className="name">participants</span><span>:</span><span>{" "}</span><span className="name">[List](https://docs.python.org/3/library/typing.html#typing.List "（在 Python v3.12）")<span>\[</span>[PYU](secretflow.device.device.device.mdx#secretflow.device.device.pyu.PYU "secretflow.device.device.pyu.PYU")<span>]</span></span></Outline.Parameter>, <Outline.Parameter><span className="name">mask\_location</span><span>=</span><span>-2</span></Outline.Parameter><span>)</span></Outline.ParameterList>
  </Outline.Signature>

  <Outline.Content>
    基类：[`Aggregator`](secretflow.security.security.aggregation.mdx#secretflow.security.aggregation.aggregator.Aggregator "secretflow.security.aggregation.aggregator.Aggregator")

    <del id="id14">Mask\_</del> <del id="id16">Heu\_</del> Aggregation presents a new federated learning secure aggregation algorithm, in which
    participants add mask at some positions of the gradient (the fully connected layer closest to the
    output layer), Then use homomorphic encryption to remove masks from the aggregated values

    The specific process is as follows.

    1\. After the participant generates the gradient locally,they add a mask at some positions of the
    gradient (the fully connected layer closest to the output layer) and use paillier homomorphic encryption
    on the mask

    2. Participants will send gradients with masks and encrypted masks to the server for aggregation

    3\. The server aggregates gradients using addition, aggregates masks in ciphertext state using homomorphic
    addition, and finally returns the aggregation results to the participants

    4. The participant decrypts the aggregated values of the mask and ultimately obtains a noise free aggregation result

    <p className="sidebar-rubric">
      备注
    </p>

    Analyzing the reasons for gradient leakage of privacy information, we found that certain positions of the

    gradient contain sensitive information. Based on the above findings, we designed this aggregation algorithm
    For more information, please refer to [https://openaccess.thecvf.com/content/CVPR2021/papers/Sun\_Soteria\_Provable\_Defense\_Against\_Privacy\_Leakage\_in\_Federated\_Learning\_From\_CVPR\_2021\_paper.pdf](https://openaccess.thecvf.com/content/CVPR2021/papers/Sun_Soteria_Provable_Defense_Against_Privacy_Leakage_in_Federated_Learning_From_CVPR_2021_paper.pdf)
    and [https://arxiv.org/abs/2001.02610](https://arxiv.org/abs/2001.02610)

    <p className="sidebar-rubric">
      示例
    </p>

    ```python
    >>> # Alice and bob are both pyu instances.
    >>> aggregator = MaskHeuAggregator(alice, [alice, bob])
    >>> a = alice(lambda :  np.array([[1, 2, 3]]))()
    >>> b = bob(lambda : np.array([[11, 12, 13]]))()
    >>> avg_a_b = aggregator.average([a, b], axis=0)
    >>> # Get the result.
    >>> sf.reveal(avg_a_b)
        array([[6. 7. 8.]])
    >>> sum_a_b = aggregator.sum([a, b], axis=0)
    >>> sf.reveal(sum_a_b)
        array([[12. 14. 16.]])
    ```

    <strong>Methods:</strong>

    <table>
      <tbody>
        <tr>
          <td>
            [`__init__`](#secretflow.security.aggregation.experiment.MaskHeuAggregator.__init__ "secretflow.security.aggregation.experiment.MaskHeuAggregator.__init__")(device, participants\[, mask\_location])
          </td>

          <td>

          </td>
        </tr>

        <tr>
          <td>
            [`average`](#secretflow.security.aggregation.experiment.MaskHeuAggregator.average "secretflow.security.aggregation.experiment.MaskHeuAggregator.average")(data\[, axis, weights])
          </td>

          <td>
            Compute the weighted average along the specified axis.
          </td>
        </tr>

        <tr>
          <td>
            [`sum`](#secretflow.security.aggregation.experiment.MaskHeuAggregator.sum "secretflow.security.aggregation.experiment.MaskHeuAggregator.sum")(data\[, axis])
          </td>

          <td>
            Sum of array elements over a given axis.
          </td>
        </tr>
      </tbody>
    </table>

    <Outline domain="py" objectType="method" target={"secretflow.security.aggregation.experiment.MaskHeuAggregator.__init__"} module={"secretflow.security.aggregation.experiment"} fullname={"MaskHeuAggregator.__init__"} parameters={["device", "participants", "mask_location"]} description={"\u57fa\u7c7b\uff1aAggregator"}>
      <Outline.Signature fullname="MaskHeuAggregator.__init__" id="secretflow.security.aggregation.experiment.MaskHeuAggregator.__init__">
        <Outline.Name>\_\_init\_\_</Outline.Name><Outline.ParameterList><span>(</span><Outline.Parameter><span className="name">device</span><span>:</span><span>{" "}</span><span className="name">[PYU](secretflow.device.device.device.mdx#secretflow.device.device.pyu.PYU "secretflow.device.device.pyu.PYU")</span></Outline.Parameter>, <Outline.Parameter><span className="name">participants</span><span>:</span><span>{" "}</span><span className="name">[List](https://docs.python.org/3/library/typing.html#typing.List "（在 Python v3.12）")<span>\[</span>[PYU](secretflow.device.device.device.mdx#secretflow.device.device.pyu.PYU "secretflow.device.device.pyu.PYU")<span>]</span></span></Outline.Parameter>, <Outline.Parameter><span className="name">mask\_location</span><span>=</span><span>-2</span></Outline.Parameter><span>)</span></Outline.ParameterList>
      </Outline.Signature>

      <Outline.Content />
    </Outline>

    <Outline domain="py" objectType="method" target={"secretflow.security.aggregation.experiment.MaskHeuAggregator.average"} module={"secretflow.security.aggregation.experiment"} fullname={"MaskHeuAggregator.average"} parameters={["data", "axis", "weights"]} description={"Compute the weighted average along the specified axis."}>
      <Outline.Signature fullname="MaskHeuAggregator.average" id="secretflow.security.aggregation.experiment.MaskHeuAggregator.average">
        <Outline.Name>average</Outline.Name><Outline.ParameterList><span>(</span><Outline.Parameter><span className="name">data</span><span>:</span><span>{" "}</span><span className="name">[List](https://docs.python.org/3/library/typing.html#typing.List "（在 Python v3.12）")<span>\[</span>[DeviceObject](secretflow.device.device.device.mdx#secretflow.device.device.base.DeviceObject "secretflow.device.device.base.DeviceObject")<span>]</span></span></Outline.Parameter>, <Outline.Parameter><span className="name">axis</span><span>=</span><span>None</span></Outline.Parameter>, <Outline.Parameter><span className="name">weights</span><span>=</span><span>None</span></Outline.Parameter><span>)</span></Outline.ParameterList>
      </Outline.Signature>

      <Outline.Content>
        Compute the weighted average along the specified axis.
      </Outline.Content>
    </Outline>

    <Outline domain="py" objectType="method" target={"secretflow.security.aggregation.experiment.MaskHeuAggregator.sum"} module={"secretflow.security.aggregation.experiment"} fullname={"MaskHeuAggregator.sum"} parameters={["data", "axis"]} description={"Sum of array elements over a given axis."}>
      <Outline.Signature fullname="MaskHeuAggregator.sum" id="secretflow.security.aggregation.experiment.MaskHeuAggregator.sum">
        <Outline.Name>sum</Outline.Name><Outline.ParameterList><span>(</span><Outline.Parameter><span className="name">data</span><span>:</span><span>{" "}</span><span className="name">[List](https://docs.python.org/3/library/typing.html#typing.List "（在 Python v3.12）")<span>\[</span>[DeviceObject](secretflow.device.device.device.mdx#secretflow.device.device.base.DeviceObject "secretflow.device.device.base.DeviceObject")<span>]</span></span></Outline.Parameter>, <Outline.Parameter><span className="name">axis</span><span>=</span><span>None</span></Outline.Parameter><span>)</span></Outline.ParameterList>
      </Outline.Signature>

      <Outline.Content>
        Sum of array elements over a given axis.
      </Outline.Content>
    </Outline>
  </Outline.Content>
</Outline>
